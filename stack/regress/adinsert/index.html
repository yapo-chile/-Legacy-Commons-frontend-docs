<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mobile adinsert (WIP) | VuePress</title>
    <meta name="generator" content="VuePress 1.7.0">
    
    <meta name="description" content="Vue En">
    
    <link rel="preload" href="/yapo/frontend-docs/assets/css/0.styles.3b5e9609.css" as="style"><link rel="preload" href="/yapo/frontend-docs/assets/js/app.ef72f83b.js" as="script"><link rel="preload" href="/yapo/frontend-docs/assets/js/2.8e564c8a.js" as="script"><link rel="preload" href="/yapo/frontend-docs/assets/js/34.f535b6c8.js" as="script"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/10.75c79d9e.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/11.bfb1df0b.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/12.c3e1aacb.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/13.1bf48269.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/14.e90524f9.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/15.4806281b.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/16.cbfb62b9.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/17.8813de4b.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/18.6c867520.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/19.fcc9e3d4.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/20.3d148014.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/21.d1e544cd.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/22.1817f7d5.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/23.2cea8178.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/24.d36ffb40.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/25.8cf56462.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/26.3149a377.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/27.7ad1049b.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/28.57010811.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/29.e028db79.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/3.c2da4979.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/30.7e86021e.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/31.f4628157.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/32.505af3b6.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/33.0690f4c2.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/35.6afa6f5c.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/36.cb3a5652.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/37.a39f9007.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/38.4c6eb847.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/4.d392ef47.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/5.38879915.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/6.6c6205d0.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/7.f19663bf.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/8.2e666515.js"><link rel="prefetch" href="/yapo/frontend-docs/assets/js/9.a5359224.js">
    <link rel="stylesheet" href="/yapo/frontend-docs/assets/css/0.styles.3b5e9609.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yapo/frontend-docs/" class="home-link router-link-active"><img src="https://static.yapo.cl/shared/icons/logo.svg" alt="VuePress" class="logo"> <span class="site-name can-hide">VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yapo/frontend-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/yapo/frontend-docs/basic/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/yapo/frontend-docs/stack/" class="nav-link router-link-active">
  Stack
</a></div><div class="nav-item"><a href="/yapo/frontend-docs/practices/" class="nav-link">
  Practices
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.mpi-internal.com/Yapo/frontend-docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docs repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docs vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yapo/frontend-docs/stack/regress/adinsert/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/yapo/frontend-docs/es/stack/regress/adinsert/" class="nav-link">
  es-CH
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/yapo/frontend-docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/yapo/frontend-docs/basic/" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/yapo/frontend-docs/stack/" class="nav-link router-link-active">
  Stack
</a></div><div class="nav-item"><a href="/yapo/frontend-docs/practices/" class="nav-link">
  Practices
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.mpi-internal.com/Yapo/frontend-docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docs repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docs vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yapo/frontend-docs/stack/regress/adinsert/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/yapo/frontend-docs/es/stack/regress/adinsert/" class="nav-link">
  es-CH
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/yapo/frontend-docs/basic/" class="sidebar-link">Getting Started</a></li><li><a href="/yapo/frontend-docs/basic/team.html" class="sidebar-link">Team</a></li><li><section class="sidebar-group depth-0"><a href="/yapo/frontend-docs/practices/" class="sidebar-heading clickable"><span>Practices</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/yapo/frontend-docs/practices/BEM/" class="sidebar-link">BEM</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/yapo/frontend-docs/stack" class="sidebar-heading clickable router-link-active open"><span>Stack</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/yapo/frontend-docs/stack/microservices/" class="sidebar-heading clickable"><span>Microservices</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/yapo/frontend-docs/stack/microservices/podium/" class="sidebar-link">Podium</a></li></ul></section></li><li><a href="/yapo/frontend-docs/stack/experiments/" class="sidebar-link">Experiments</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/yapo/frontend-docs/stack/widgets/" class="sidebar-heading clickable"><span>Widgets</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/yapo/frontend-docs/stack/widgets/yapo-legacy-fe/" class="sidebar-link">Yapo Legacy fe</a></li><li><a href="/yapo/frontend-docs/stack/widgets/custom-elements/" class="sidebar-link">Custom Elements</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/yapo/frontend-docs/stack/regress/" class="sidebar-heading clickable router-link-active open"><span>Regress</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/yapo/frontend-docs/stack/regress/develop-remotely/" class="sidebar-link">Develop remotely</a></li><li><a href="/yapo/frontend-docs/stack/regress/adinsert/" aria-current="page" class="active sidebar-link">Mobile Adinsert</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#globals" class="sidebar-link">Globals</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#appl" class="sidebar-link">appl</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#showdraft" class="sidebar-link">showDraft</a></li></ul></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#node" class="sidebar-link">Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#id" class="sidebar-link">id</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#initdraft" class="sidebar-link">initDraft</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#clear" class="sidebar-link">clear</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#getvalue" class="sidebar-link">getValue</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#setvalue" class="sidebar-link">setValue</a></li></ul></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#draft" class="sidebar-link">Draft</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#available" class="sidebar-link">_available</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#draftednodes" class="sidebar-link">_draftedNodes</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#draftstoreuri" class="sidebar-link">_draftStoreUri</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#available-2" class="sidebar-link">available</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#draftme" class="sidebar-link">draftMe</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#reset" class="sidebar-link">reset</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#nodeonchange" class="sidebar-link">nodeOnChange</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#getvaluefromstorage" class="sidebar-link">getValueFromStorage</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#setvaluetostorage" class="sidebar-link">setValueToStorage</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#removevaluefromstorage-node" class="sidebar-link">removeValueFromStorage(node)</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#setdraftflag" class="sidebar-link">setDraftFlag</a></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#removedraftflag" class="sidebar-link">removeDraftFlag</a></li></ul></li><li class="sidebar-sub-header"><a href="/yapo/frontend-docs/stack/regress/adinsert/#adparams-node" class="sidebar-link">AdParams Node</a></li></ul></li></ul></section></li><li><a href="/yapo/frontend-docs/stack/test/" class="sidebar-link">Test</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mobile-adinsert-wip"><a href="#mobile-adinsert-wip" class="header-anchor">#</a> Mobile adinsert (WIP)</h1> <p>So you were asked to make some changes on the adinsert for mobile (msite), and you don't know where to start? I got you covered!</p> <p>The first thing to know about the adinsert is that everything builds on top of a <strong>Nodes</strong> and the <strong>Draft</strong>. The first one are small portions of the adinsert like Adinfo or UserInfo, the second one holds all the Nodes, manages their lifecycle, takes care of the data storage, and data cleaning. The file, at <code>msite/www/js/new_ai_draft.js</code>, actually doesn't shares so much info about, so i will do for you:</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>While its true that the current implementations uses pure JS, i will do the examples and definitions using TS for more clarity.</p></div> <h2 id="globals"><a href="#globals" class="header-anchor">#</a> Globals</h2> <p>Before digging into the <code>Nodes</code> and the <code>Draft</code>, there are some global variables and methods that are not neccesarily defined in our <code>Draft</code> file, but are used by it.</p> <h3 id="appl"><a href="#appl" class="header-anchor">#</a> appl</h3> <ul><li>Type: <code>'li'|'vi'|'newad'|'editad'</code></li> <li>Description: A string that references what part of the site we are currently in:
<ul><li><code>'li'</code>: listing</li> <li><code>'vi'</code>: ad view</li> <li><code>'newad'</code>: ad insert</li> <li><code>'editad'</code>: edit ad</li></ul></li></ul> <h3 id="showdraft"><a href="#showdraft" class="header-anchor">#</a> showDraft</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">showDraft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: Hides or show the draft bar (the one that puts 'Tienes un aviso guardado. Publicalo ahora' and 'Limpiar formulario'). When the value of <code>yapoDraft.' + location.host + '/mai/form/.showDraft</code> on the session storage is equal to <code>1</code> <strong>and</strong> the appl is not <code>editad</code> (i.e., user is not editing an ad) it will show the bar, in any other case it will hide it.</li></ul> <h2 id="node"><a href="#node" class="header-anchor">#</a> Node</h2> <p>A Node is a subsection of the adinsert, like Adinfo, UserInfo or GeoPosition. Each Node has its <code>value</code>, which is usually an object or an array of objects that contains info about that subsection, for example, the UserInfo Node values looks like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;user_type&quot;</span><span class="token punctuation">,</span>           <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;0&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#name&quot;</span><span class="token punctuation">,</span>               <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#email&quot;</span><span class="token punctuation">,</span>              <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#rut&quot;</span><span class="token punctuation">,</span>                <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#phone&quot;</span><span class="token punctuation">,</span>              <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#area_code&quot;</span><span class="token punctuation">,</span>          <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#switch&quot;</span><span class="token punctuation">,</span>             <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#phoneInputTypeHome&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;#is_company_c&quot;</span><span class="token punctuation">,</span>       <span class="token string">&quot;value&quot;</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>Generally speaking, a Node should look like this:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Node</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">initDraft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Is worth mentioning that some of the methods wont't make much sense on their own unless you understand how the Draft works. Also, while is true that each Node could implement each method on its own way, there are some common things that are present in every implementation, we will  define those in the following section.</p> <h3 id="id"><a href="#id" class="header-anchor">#</a> id</h3> <ul><li>Type: <code>string</code></li> <li>Description: An unique identificator of the Node.</li></ul> <h3 id="initdraft"><a href="#initdraft" class="header-anchor">#</a> initDraft</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">initDraft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: In this part the <code>Node</code> calls the <code>draftMe</code> method from the <code>Draft</code> so the <code>Node</code> gets initialized. Some Nodes adds behaviors that need to happen before and just after its initialization. Is also common that the <code>nodeOnChange</code> method gets tied to an event in this section.</li></ul> <h3 id="clear"><a href="#clear" class="header-anchor">#</a> clear</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: Describes what to do when the <code>Draft</code> gets cleared for whatever reason.</li></ul> <h3 id="getvalue"><a href="#getvalue" class="header-anchor">#</a> getValue</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: Returns the current value of the Node. The value is specific to each Node, but typically it holds a group of values.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Usually the value is retrieved directly from the HTML because it is not saved in the JS.</p></div> <h3 id="setvalue"><a href="#setvalue" class="header-anchor">#</a> setValue</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: Sets the value of the node.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Usually the value is changed directly on the HTML and is not saved in the JS.</p></div> <h2 id="draft"><a href="#draft" class="header-anchor">#</a> Draft</h2> <p>The Draft holds all the Nodes, and manages their lifecycles and the communication between the values and the session storage (this means saving, retrieving and deleting data from it).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The saved data on the session storage is generally the <code>value</code> of each <code>node</code> and the <code>.showDraft</code> and <code>.hasDraft</code> current values.</p></div> <h3 id="available"><a href="#available" class="header-anchor">#</a> _available</h3> <ul><li>Type: <code>boolean | undefined</code></li> <li>Default: <code>undefined</code></li> <li>Description: Can be set manually to <code>true</code>or <code>false</code>, but by default tells whether we are visiting the adinsert or not.</li></ul> <h3 id="draftednodes"><a href="#draftednodes" class="header-anchor">#</a> _draftedNodes</h3> <ul><li>Type: <code>{ [key: string]: Node }</code></li> <li>Default: <code>{}</code></li> <li>Description: Object that stores all the nodes of the current draft. The keys are the nodes IDs.</li></ul> <h3 id="draftstoreuri"><a href="#draftstoreuri" class="header-anchor">#</a> _draftStoreUri</h3> <ul><li>Type: <code>string</code></li> <li>Default: <code>'yapoDraft.' + location.host + '/mai/form/'</code></li> <li>Description: Contains the URI for the draft, which is usually used for saving, retrieveing and removing data from the session storage.</li></ul> <h3 id="available-2"><a href="#available-2" class="header-anchor">#</a> available</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">available</span><span class="token punctuation">(</span>value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: The method has three behaviors
<ul><li>When called with <code>undefined</code> or no params, returns the current value of the <code>_avaliable</code> variable.</li> <li>When called with a <code>boolean</code>, overrides the <code>_available</code> variable with <code>value</code> and returns it.</li> <li>When called with <code>null</code>, returns whether the current location is on the adinsert or not (based on the value of the <code>appl</code> global variable)</li></ul></li></ul> <h3 id="draftme"><a href="#draftme" class="header-anchor">#</a> draftMe</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">draftMe</span><span class="token punctuation">(</span>node<span class="token operator">:</span> Node<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: If the draft is available (checking with the <code>available</code> method), adds <code>node</code> to the <code>_draftedNodes</code> object, and calls <code>node.setValue</code> (if it is defined) with its corresponding data stored at session storage.</li></ul> <h3 id="reset"><a href="#reset" class="header-anchor">#</a> reset</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">reset</span><span class="token punctuation">(</span>soft<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">?</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: this method does four different things:
<ul><li>Loops all the nodes in <code>_draftedNodes</code> and:
<ul><li>If <code>soft == true</code>, calls the <code>node.clear</code> method (if it is defined).</li> <li>Removes its stored <code>value</code> with <code>removeValueFromStorage</code> (except if the key (AKA node ID) of the node is <code>userInfo</code>).</li></ul></li> <li>Removes the draft flags with <code>removeDraftFlag</code></li> <li>Refreshes the visibility of the draftbar with  <code>showDraft</code>.</li> <li>Returns a <code>xt_click</code> call.</li></ul></li></ul> <h3 id="nodeonchange"><a href="#nodeonchange" class="header-anchor">#</a> nodeOnChange</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">nodeOnChange</span><span class="token punctuation">(</span>node<span class="token operator">:</span> Node<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: If the draft is available (checking with the <code>available</code> method), saves the node value on the storage with <code>setValueToStorage</code> and refreshes the visibility of the draftbar with  <code>showDraft</code>. Its important to note that this method needs to be called manually by each <code>Node</code> when there is a <code>value</code> change.</li></ul> <h3 id="getvaluefromstorage"><a href="#getvaluefromstorage" class="header-anchor">#</a> getValueFromStorage</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">getValueFromStorage</span><span class="token punctuation">(</span>node<span class="token operator">:</span> Node<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Description: Returns the <code>value</code> of the input <code>node</code>stored in the session storage.</li></ul> <h3 id="setvaluetostorage"><a href="#setvaluetostorage" class="header-anchor">#</a> setValueToStorage</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">setValueToStorage</span><span class="token punctuation">(</span>node<span class="token operator">:</span> Node<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Description: Saves the <code>value</code> of the input <code>node</code> on the session storage. It only works if the node has implemented the method <code>node.getValue</code>. Also calls the method <code>setDraftFlag</code>.</li></ul> <h3 id="removevaluefromstorage-node"><a href="#removevaluefromstorage-node" class="header-anchor">#</a> removeValueFromStorage(node)</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">removeValueFromStorage</span><span class="token punctuation">(</span>node<span class="token operator">:</span> Node<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Description: Removes the <code>value</code> of the input <code>node</code> stored in the session storage.</li></ul> <h3 id="setdraftflag"><a href="#setdraftflag" class="header-anchor">#</a> setDraftFlag</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">setDraftFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: Find the keys<code>_draftStoreUri + .showDraft</code> and <code>_draftStoreUri + .hasDraft</code> on the session storage and asigns the value <code>1</code> to them.</li></ul> <h3 id="removedraftflag"><a href="#removedraftflag" class="header-anchor">#</a> removeDraftFlag</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">removeDraftFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><ul><li>Type: <code>function</code></li> <li>Description: Find the keys <code>_draftStoreUri + .showDraft</code> and <code>_draftStoreUri + .hasDraft</code> on the session storage and removes them.</li></ul> <h2 id="adparams-node"><a href="#adparams-node" class="header-anchor">#</a> AdParams Node</h2> <p>On the file at <code>msite/www/js/new_ai.cats.js</code>, we can find an insteresting <code>Node</code> called <code>AdParamsNode</code>. Also in the same file there are three custom implementations to existing HTML elements: <code>AdParamSelect</code>, <code>AdParamInput</code> and <code>AdParamCheckbox</code>. The Node looks like this:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">AdParams</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">initDraft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">create</span><span class="token punctuation">(</span>parentSelect <span class="token operator">??</span><span class="token punctuation">,</span> childs <span class="token operator">??</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">reset</span><span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">load</span><span class="token punctuation">(</span>category <span class="token operator">??</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">selectTheOnlyValue</span><span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">createAdType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">push</span><span class="token punctuation">(</span>element <span class="token operator">??</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">labelKeyLookup</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token operator">??</span><span class="token punctuation">;</span>
    <span class="token function">getLabelFor</span><span class="token punctuation">(</span>param <span class="token operator">??</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token function">afterSelect</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token function">afterSelectCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">afterSelectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">afterSelectEstateType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">setOptionalInputs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">focusUtil</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">afterSelectFootwearGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yapo/frontend-docs/stack/regress/develop-remotely/" class="prev">
        Develop remotely
      </a></span> <span class="next"><a href="/yapo/frontend-docs/stack/test/">
        Test
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yapo/frontend-docs/assets/js/app.ef72f83b.js" defer></script><script src="/yapo/frontend-docs/assets/js/2.8e564c8a.js" defer></script><script src="/yapo/frontend-docs/assets/js/34.f535b6c8.js" defer></script>
  </body>
</html>
